<html>
<head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no"/>
    <style type="text/css">
        html {
            height: 100%
        }

        body {
            height: 100%;
            margin: 0px;
            padding: 0px
        }

        #map_canvas {
            height: 100%
        }
    </style>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://maps.google.com/maps/api/js?sensor=false">
    </script>
    <script type="text/javascript">
        $(function () {
            $.ajax({
                url: "http://im.someline.com/mha",
                dataType: "jsonp",
                success: function (data) {
                    var dataString = JSON.stringify(data, null, 4);
                    initialize(data);
                },
                fail: function () {
                    alert("error")
                }
            });
        });
        function initialize(data) {
            var latlng = new google.maps.LatLng(1.3146632,103.8454093);
            var myOptions = {
                zoom: 11,
                center: latlng,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            };
            var map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);


            function addMarker(markerObj) {
                var hLatlng = new google.maps.LatLng(markerObj.latitude, markerObj.longtitude);
                var infoTitle = "<p>" + markerObj.name + "</p>" +
                        "<p>Postal Code:" + markerObj.postal_code + "</p>";

                var hTitle = "click for more details";

                var infowindow = new google.maps.InfoWindow({
                    content: infoTitle
                });

                var marker = new google.maps.Marker({
                    position: hLatlng,
                    map: map,
                    title: hTitle
                });

                google.maps.event.addListener(marker,
                        'click', infoCallback(infowindow, marker));

            }

            function infoCallback(infowindow, marker) {
                return function () {
                    infowindow.open(map, marker);
                };
            }


            $.each(data, function (key, val) {
                console.log(val);
                addMarker(val);
            });

        }
    </script>
</head>
<body>
<div id="map_canvas" style="width:100%; height:100%"></div>
<!--<div class="hi"></div>-->
</body>
</html>
